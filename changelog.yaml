-   name: 14.0.3
    date: '2025-12-01T13:24:13.031334+03:00'
    description: Уровень логирования исправлен на warn при проверке external флага
        для внутренних апстримов
    instructions: ''
    compatible: true

-   name: 14.0.2
    date: '2025-12-01T12:33:03.673270+03:00'
    description: Для external запросов включена проверка дедлайнов. Исправлена ошибка
        проставления таймаута
    instructions: ''
    compatible: true

-   name: 14.0.1
    date: '2025-11-27T12:55:42.690555+03:00'
    description: Обновление trace-context до 2.0.1
    instructions: ''
    compatible: true

-   name: 14.0.0
    date: '2025-11-21T18:35:27.646527+03:00'
    description: Добавлена возможность конфигурировать cross dc для конкретных апстримов.
        Для этого необходимо использовать настройку jclient.upstream.crossDCServices.
        Настройка allowCrossDCRequests больше не обрабатывается
    instructions: В объекте Properties, который передается в метод UpstreamServiceConsulConfig#fromPropertiesWithDefaults,
        необходимо вместо настройки allowCrossDCRequests передавать настройку jclient.upstream.crossDCServices
        со списком апстримов, в которые нужно ходить кросс дц. Если инстанс данного
        класса создается с помощью конструктора, тогда список апстримов, в которые
        нужно ходить кросс дц, необходимо передавать с помощью вызова метода setCrossDCUpstreams.
        Также необходимо поправить места, где вызываются конструкторы классов BalancingUpstreamManager
        и Upstream - из их сигнатуры удален параметр allowCrossDCRequests
    compatible: false

-   name: 13.0.1
    date: '2025-11-20T18:15:14.454555+03:00'
    description: Исправлена ошибка, из-за которой фьючи не комплитились, если в `onThrowable`
        вылетал эксепшен.
    instructions: ''
    compatible: true

-   name: 13.0.0
    date: '2025-11-19T11:21:27.230420+03:00'
    description: Добавлено логирование при неправильном проставлении ru.hh.jclient.common.HttpClient#external()
    instructions: Заменить использование ru.hh.jclient.common.RequestBuilder#setExternalRequest
        на ru.hh.jclient.common.HttpClient#external()
    compatible: false

-   name: 12.0.1
    date: '2025-11-11T11:23:22.658519+03:00'
    description: Обновление trace-context до 2.0.0
    instructions: ''
    compatible: true

-   name: 12.0.0
    date: '2025-10-14T12:14:10.435360+03:00'
    description: При отправке запроса значение заголовка X-Request-Id берется из traceContext'а.
        Удален метод HttpClientContextThreadLocalSupplier.ContextBuilder#withRequestId.
        Также из реализации HttpClientContextThreadLocalSupplier.ContextBuilder удалена
        логика получения rid из MDC / установка rid в MDC. То есть при вызове метода
        HttpClientContextThreadLocalSupplier#forCurrentThread rid не будет браться
        из MDC и добавляться в заголовок запроса. В конструкторы классов HttpClientFactory
        и HttpClientFactoryBuilder добавлен еще один аргумент - TraceContext. В методы
        интерфейса Monitoring добавлен еще один аргумент - HttpHeaders. Удален класс
        ResponseWrapper, вместо него добавлен RequestResponseWrapper.
    instructions: В коде сервиса необходимо удалить добавление заголовка X-Request-Id
        - вместо этого необходимо перед отправкой запроса где то по стеку выше вызывать
        метод TraceContext#setTraceId или его аналоги (более подробное описание всех
        методов, которые предоставляет TraceContext, и примеры их использования можно
        посмотреть в javadoc). То есть не нужно больше при создании объекта HttpClientContext,
        при вызове методов HttpClientContextThreadLocalSupplier#addContext, HttpClientContextThreadLocalSupplier.ContextBuilder#withHeaders,
        RequestBuilder#addHeader и тд передавать заголовок X-Request-Id - он добавится
        автоматически. Перед вызовом метода HttpClientContextThreadLocalSupplier#forCurrentThread
        тоже должен вызываться TraceContext#setTraceId или его аналоги. Использование
        метода HttpClientContextThreadLocalSupplier.ContextBuilder#withRequestId Необходимо
        удалить. При создании объектов HttpClientFactory и HttpClientFactoryBuilder
        необходимо передать в конструктор объект TraceContext. Вместо класса ResponseWrapper
        необходимо использовать RequestResponseWrapper. В классах, имплементирующих
        интерфейс Monitoring, необходимо поправить сигнатуру методов countRequest,
        countRequestTime и countRetry - теперь они принимают еще один аргумент HttpHeaders.
    compatible: false

-   name: 11.0.5
    date: '2025-09-24T16:12:34.237678+03:00'
    description: Фикс избыточной конвертации при логировании длины ответа и оптимизация
        вычисления параметров
    instructions: ''
    compatible: true

-   name: 11.0.4
    date: '2025-09-16T16:53:35.865144+03:00'
    description: bugfix for requestTimeout within DeadlineCheckerAndPropagator
    instructions: ''
    compatible: true

-   name: 11.0.3
    date: '2025-08-21T14:55:59.975376+03:00'
    description: Для тестов используется JUnit 5
    instructions: ''
    compatible: true

-   name: 11.0.2
    date: '2025-08-21T14:51:22.461501+03:00'
    description: Правильно проставляются заголовки X_DEADLINE_TIMEOUT_MS и X_OUTER_TIMEOUT_MS
    instructions: ''
    compatible: true

-   name: 11.0.1
    date: '2025-07-31T16:48:16.750623+03:00'
    description: "Добавлена опция отключения дедлайна.\r\nДля запроса можно выставить\
        \ RequestBuilder.setDeadlineEnabled(false). По умолчанию=true"
    instructions: ''
    compatible: true

-   name: 11.0.0
    date: '2025-07-08T18:44:39.543009+03:00'
    description: "Cмержены интерфейсы RequestDebug и HttpClientEventListener\r\nУдален\
        \ RequestDebug.DISABLED\r\nДобавлена проверка дедлайн таймаутов. Изменен конструктор\
        \ HttpClientContext, интерфейс HttpClientEventListener"
    instructions: "Заменить использование RequestDebug на HttpClientEventListener\r\
        \nУбрать из конструкторов и методов добавление реализаций HttpClientEventListener\
        \ в классах: HttpClientFactory, HttpClientFactoryBuilder.\r\nПереименовать\
        \ TestRequestDebug-> TestEventListener\r\nУдалить использование RequestDebug.DISABLED\r\
        \nВключить DeadlineContextCheck в конфигах\r\nЗаменить использование метода\
        \ HttpClientEventListener.beforeExecute(HttpClient httpClient, Request request)\
        \ на HttpClientEventListener.beforeExecute(HttpClient httpClient, RequestBuilder\
        \ requestBuilder, Request request)\r\nHttpClientContext заменить вызов конструтора\
        \ с LocalDateTime на OffsetDateTime"
    compatible: false

-   name: 10.0.1
    date: '2025-06-30T11:38:24.535187+03:00'
    description: Добавлен try-catch, чтобы не падать во время проблем с request debug
    instructions: ''
    compatible: true

-   name: 10.0.0
    date: '2025-06-24T11:31:33.622595+03:00'
    description: 'Добавлена возможность включения адаптивной балансировки для конкретного
        апстрима с помощью ключа `balancing_strategy: adaptive` в апстрим-конфиге.
        Также добавлена отправка используемого типа балансировки в мониторинг.'
    instructions: "Если хотите включить адаптивную балансировку для апстрима, нужно\
        \ добавить `balancing_strategy: adaptive` в корень конфига (на том же уровне,\
        \ что и `hosts`), но не рекомендуется этого делать, пока большинство клиентов\
        \ апстрима не обновятся до этой версии.\r\nУ методов `BalancingState.getCurrentServer()`\
        \ и `BalancingState.setCurrentServer()` уровень видимости уменьшен до package-private,\
        \ не используйте их.\r\nВ методе `UpstreamConfigs.of()` добавлен параметр\
        \ `@Nullable String balancingStrategyType` - тип балансировки (`null` - дефолтная,\
        \ `\"weighted\"` / `\"adaptive\"` - конкретная).\r\nВ интерфейсе `Monitoring`\
        \ в методе `countRequest()` добавлен параметр `String balancingStrategyType`,\
        \ туда приходит тип балансировки конкретного запроса."
    compatible: false

-   name: 9.0.2
    date: '2025-06-16T11:39:14.607156+03:00'
    description: Рефакторинг адаптивной балансировки.
    instructions: ''
    compatible: true

-   name: 9.0.1
    date: '2025-06-05T12:48:16.504455+03:00'
    description: Исправлен баг - при использовании метода HttpClientContextThreadLocalSupplier.forCurrentThread
        не отрабатывали зарегистрированные RequestDebug'и
    instructions: ''
    compatible: true

-   name: 9.0.0
    date: '2025-05-16T11:27:26.664010+03:00'
    description: "Добавлены методы RequestBalancerBuilder#withExternalRetryPolicy,\
        \ RequestBalancerBuilder#withExternalMaxTries\r\nПереименован метод RequestBalancerBuilder#withMaxTimeoutTries->RequestBalancerBuilder#withExternalMaxTimeoutTries;\r\
        \nМетод RequestBalancerBuilder#withExternalMaxTries теперь работает только\
        \ для external запросов\r\nВ RequestBalancer, UpstreamRequestBalancer и ExternalUrlRequestor\
        \ поменялась сигнатура конструктора\r\nВ RetryPolicy добавился новый конструктор"
    instructions: "Исправить вызов конструкторов RequestBalancer, UpstreamRequestBalancer,\
        \ ExternalUrlRequestor.\r\nПереименовать метод RequestBalancerBuilder#withMaxTimeoutTries->RequestBalancerBuilder#withExternalMaxTimeoutTries.\
        \ Если было использование для внутренних апстримов, то нужно добавить конфигурацию\
        \ в upstrem-config.yaml"
    compatible: false

-   name: 8.0.1
    date: '2025-05-06T18:26:42.278870+03:00'
    description: Из логов убрано предупреждение "Unexpected object when removing null
        - null".
    instructions: ''
    compatible: true

-   name: 8.0.0
    date: '2025-04-24T14:26:18.360356+03:00'
    description: В конфигурации апстримов изменено название ключа, который отвечает
        за разрешение ретраить неидемпотентные запросы.
    instructions: Перед обновлением убедитесь, что в конфигах апстримов в консуле
        для политики ретраев используется ключ `retry_non_idempotent`.
    compatible: false

-   name: 7.0.0
    date: '2025-04-16T17:10:08.314525+03:00'
    description: Migration to Jakarta
    instructions: In case of marshalling via JAXB - use Jakarta JAXB instead of Javax;
        JCLient API dependant on javax.ws.rs now use jakarta.ws.rs - adapt your code
        for work with jakarta.ws.rs instead of javax.ws.rs
    compatible: false

-   name: 6.0.0
    date: '2025-04-15T16:58:35.235800+03:00'
    description: Удален модуль jclient-common-metrics
    instructions: Из помника удалить зависимость jclient-common-metrics. Самостоятельно
        реализовать классы StatsDMetricsConsumer, MetricsConsumerFactory, UpstreamMonitoring,
        MonitoringBalancingUpstreamManagerFactory или скопировать удаленные реализации,
        если в них есть необходимость
    compatible: false

-   name: 5.0.1
    date: '2025-04-15T10:46:38.894991+03:00'
    description: Добавлена обработка ошибок, возникающих при отправке метрик
    instructions: ''
    compatible: true

-   name: 5.0.0
    date: '2025-04-10T15:41:04.689783+03:00'
    description: Из jclient-common-metrics удален класс KafkaUpstreamMonitoring и
        зависимость kafka-clients. Также изменена сигнатура метода MonitoringBalancingUpstreamManagerFactory.createWithDefaults
        - данный метод вместо объекта Properties, который использовался для создания
        объекта KafkaUpstreamMonitoring, теперь принимает "Set<Monitoring> additionalMonitoring"
    instructions: Самостоятельно реализовать KafkaUpstreamMonitoring, если есть необходимость
        в отправке сообщений в кафку (можно скопировать удаленную реализацию KafkaUpstreamMonitoring),
        создать инстанс KafkaUpstreamMonitoring и передать его в метод MonitoringBalancingUpstreamManagerFactory.createWithDefaults
    compatible: false

-   name: 4.1.1
    date: '2025-04-02T16:43:55.593162+03:00'
    description: make clear logging of active/dead upstream instances
    instructions: ''
    compatible: true

-   name: 4.1.0
    date: '2024-11-06T14:34:42.432068+03:00'
    description: add option to disable noServersInUpstream check for specific upstreams
    instructions: ''
    compatible: true

-   name: 4.0.0
    date: '2024-09-06T18:13:51.689799+03:00'
    description: "Внутренние ретраи netty теперь по умолчанию отключены (можно включить\
        \ настройкой `jclient.maxRequestRetries=` или вызовом `HttpClientFactoryBuilder.withMaxRequestRetries()`,\
        \ но не рекомендуется, т.к. эти ретраи не знают про балансировку).\r\nДля\
        \ плагина `jclient-common-maven-enforcer` минимальная версия maven поднята\
        \ до 3.8.6."
    instructions: Если у вас подключен плагин `jclient-common-maven-enforcer`, то
        надо убедиться, что для сборки проекта используется maven 3.8.6 или выше.
    compatible: false

-   name: 3.12.15
    date: '2024-05-06T12:30:30.826346+03:00'
    description: добавлен destination Host в opentelemetry
    instructions: Изменены настройки приватности класса RequestContext
    compatible: false

-   name: 3.12.13
    date: '2024-04-09T15:28:52.081148+03:00'
    description: ''
    instructions: ''
    compatible: true

-   name: 3.12.12
    date: '2024-03-26T14:26:13.248371+03:00'
    description: 'update dependencies: public-pom 1.57.0, common-errors 0.0.8, nab-metrics
        4.49.2'
    instructions: ''
    compatible: true

-   name: 3.12.11
    date: '2024-03-15T16:57:57.224967+03:00'
    description: pretty logging for adaptive balancing + unit test
    instructions: ''
    compatible: true

-   name: 3.12.10
    date: '2024-03-11T18:05:06.597668+03:00'
    description: more flexible adaptive balancing for new servers
    instructions: ''
    compatible: true

-   name: 3.12.9
    date: '2024-03-05T17:30:23.691989+03:00'
    description: fix sending disabled upstreams to okmeter
    instructions: ''
    compatible: true

-   name: 3.12.8
    date: '2024-03-01T14:27:39.753795+03:00'
    description: Исправление бага зависающего потока
    instructions: ''
    compatible: true

-   name: 3.12.7
    date: '2024-02-08T16:54:57.988581+03:00'
    description: fix adaptive balancing for retries count > servers count
    instructions: ''
    compatible: true

-   name: 3.12.6
    date: '2024-02-05T13:06:25.316690+03:00'
    description: make window functions public
    instructions: ''
    compatible: true

-   name: 3.12.5
    date: '2024-02-05T11:18:38.398491+03:00'
    description: fix npe
    instructions: ''
    compatible: true

-   name: 3.12.4
    date: '2024-02-02T16:02:26.946972+03:00'
    description: optimise logs
    instructions: ''
    compatible: true

-   name: 3.12.3
    date: '2024-01-23T11:13:22.412075+03:00'
    description: add setting for response log level
    instructions: ''
    compatible: true

-   name: 3.12.2
    date: '2024-01-22T16:27:08.219070+03:00'
    description: get back support for enabled/disabled upstreams
    instructions: ''
    compatible: true

-   name: 3.12.1
    date: '2023-11-15T10:32:05.923435+03:00'
    description: Обновление public-pom до 1.55.0
    instructions: ''
    compatible: true

-   name: 3.12.0
    date: '2023-11-03T15:33:10.058671+03:00'
    description: "* add getters for ContentType;\r\n* add extra constants in HttpHeaderNames:\
        \ Cache-Control, Content-Length, Cookie, Expires, Pragma."
    instructions: ''
    compatible: true

-   name: 3.11.2
    date: '2023-10-11T23:16:53.526130+03:00'
    description: ClosedChannelException и ChannelOutputShutdownException маппятся
        в 599
    instructions: ''
    compatible: true

-   name: 3.11.1
    date: '2023-09-18T13:26:03.470873+03:00'
    description: support disabling thread local for HttpClientContextThreadLocalSupplier
    instructions: ''
    compatible: true

-   name: 3.11.0
    date: '2023-05-11T13:18:56.369787+03:00'
    description: "* Обновление public-pom до 1.54.0\r\n* Optional больше не используется\
        \ в аргументах аргументах и полях класса"
    instructions: "* в методах и конструкторах публичного API где раньше передавался\
        \ Optional теперь нужно передавать значение без обёртки или null. Например,\
        \ классы ResultWithStatus, ResultOrErrorWithStatus, ResultOrErrorwithResponse,\
        \ EmptyOrErrorWithStatus, RequestDebug.\r\n* При имплементации TypeConverter.getSupportedContentTypes\
        \ в возвращаемом типе теперь ожидается Collection вместо Optional<Collection>.\
        \  НЕ! передавайте null! Вместо этого используйте любую пустую коллекцию."
    compatible: false

-   name: 3.10.1
    date: '2023-04-13T16:05:03.788413+03:00'
    description: изменены микро секунды на мили
    instructions: ''
    compatible: true

-   name: 3.10.0
    date: '2023-04-10T13:00:25.279494+03:00'
    description: "* up public-pom to 1.53.1\r\n* up Java to 17"
    instructions: Update Java to 17 or higher if not already updated
    compatible: false

-   name: 3.9.16
    date: '2023-04-05T14:28:34.711128+03:00'
    description: add X-TMS-Session-Proto header to PASS_THROUGH_HEADERS
    instructions: ''
    compatible: true

-   name: 3.9.15
    date: '2023-03-23T15:34:48.052014+03:00'
    description: Update com.google.protobuf 3.19.3 -> 3.22.2
    instructions: ''
    compatible: true

-   name: 3.9.14
    date: '2023-02-15T08:59:29.026578+03:00'
    description: Add support of contract tests with reverse convert functions
    instructions: ''
    compatible: true

